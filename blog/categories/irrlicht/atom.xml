<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Irrlicht | ktkr3d]]></title>
  <link href="http://ktkr3d.github.io/blog/categories/irrlicht/atom.xml" rel="self"/>
  <link href="http://ktkr3d.github.io/"/>
  <updated>2013-11-30T23:15:04+09:00</updated>
  <id>http://ktkr3d.github.io/</id>
  <author>
    <name><![CDATA[ktkr3d]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[minetest]]></title>
    <link href="http://ktkr3d.github.io/blog/2013/11/04/minetest/"/>
    <updated>2013-11-04T21:28:00+09:00</updated>
    <id>http://ktkr3d.github.io/blog/2013/11/04/minetest</id>
    <content type="html"><![CDATA[<p><a href="http://ktkr3d.github.io/images/minetest_ogl42.png"><img src="/images/minetest_ogl42_tn.png"></a></p>

<p><a href="http://minetest.net/">http://minetest.net/</a></p>

<p>minecraft のクローンminetest がUbuntu の標準リポジトリに登録されていたので、遊んでみました。
minetest はIrrlicht エンジンを利用して実装されています。
動作は軽快ですが、一部文字が表示されない箇所がありました。</p>

<!-- more -->


<h4>サーバへの接続方法</h4>

<p>初期画面の一部の文字が表示されていなかったので、適当に勘を働かせて操作してみます。</p>

<ol>
<li>左から二番目のタブ(マルチプレイヤー)を選択</li>
<li>下のテキストボックスに、サーバのIP アドレスとポート番号を入力(<code>http://servers.minetest.net/</code>から適当に選ぶ)</li>
<li>右上から二番目のテキストボックスにパスワードを入力</li>
<li>右下のボタン(接続)を押下</li>
</ol>


<p>グラフィックがオンボードでATOM なOpenGL 1.4 の環境で動かしてみると、さすがに重かったです。</p>

<p><a href="http://ktkr3d.github.io/images/minetest_ogl14.png"><img src="/images/minetest_ogl14_tn.png"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Irrlicht Android Media Player]]></title>
    <link href="http://ktkr3d.github.io/blog/2013/08/11/irrlicht-android-media-player/"/>
    <updated>2013-08-11T03:47:00+09:00</updated>
    <id>http://ktkr3d.github.io/blog/2013/08/11/irrlicht-android-media-player</id>
    <content type="html"><![CDATA[<p><a href="http://ktkr3d.github.io/images/irrlicht_android_player_tab.png"><img src="/images/irrlicht_android_player_tab_tn.png"></a></p>

<p>Android のNative Activity で実装したアプリからオーディオの再生ができたので、ミクさんが踊ってくれるメディアプレイヤー的なものにしてみました。</p>

<!-- more -->


<h4>PMD とVMD のロード処理の修正</h4>

<p>以前のソースコードがHDD の故障とともに消えてしまったので、コードやMakefile を書きなおしていたところ、うまくロードできないPMD、VMD があることに気が付きました。
BinaryReader のロード処理で、プロセッサ種別に依存してうまく取り込めない(ARM CPU で構造体のアラインメントが異なる)のが原因のようです。<br/>
以前のバージョンのコンパイラ＋古いバージョンのAndroid デバイスでは動いていたような気がするのに。
原因は単純なので修正しておきました。</p>

<h4>Native Activity からのWakeLock の制御</h4>

<p>少し経つと画面が暗くなって、画面が非表示状態になります。
PowerManager のWakeLock を制御すれば良さそうです。
Android NDK のNative Activity の場合はJNI を経由してPower Manager へアクセスするのかな。
後で調べておこう。</p>

<h4>画面インタフェース</h4>

<ul>
<li><strong>パネル表示切替ボタン「⇅」</strong><br/>
画面下部の設定用のインタフェースの表示/非表示を切り替える。曲目リスト、モデルリスト、環境設定のタブがある。</li>
<li><strong>ミュート切替ボタン「♪」</strong><br/>
音声の出力状態を切り替える。OpenSL ES の<code>(*uriPlayerVolume)-&gt;SetMute()</code>をコールしている。</li>
<li><strong>再生/停止切替ボタン「▶」</strong><br/>
モーションと音声の再生/停止を切り替える。アニメーションスピードの切り替えと<code>(*uriPlayerPlay)-&gt;SetPlayState()</code>をコールしている。モデルまたは曲を変更した場合は最初から開始する。</li>
<li><strong>終了ボタン「×」</strong><br/>
アプリケーションを終了する。</li>
<li><strong>カメラ位置スクロールバー</strong><br/>
カメラの位置を前後させる。</li>
</ul>


<h4>TODO</h4>

<ul>
<li><code>state-&gt;onAppCmd</code> にコールバック関数を設定しているのにキックされない原因を調べる。</li>
<li><code>pFileSystem-&gt;createFileList()</code> が失敗する原因を調べる。</li>
<li>タスク復帰時に描画コンテキストをリストアする。</li>
<li>GUI のSkin を変更する。</li>
<li>Android 固有の入力イベントに対応する。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Compiling Irrlicht ogl-es branch for Android]]></title>
    <link href="http://ktkr3d.github.io/blog/2013/08/04/compiling-irrlicht-ogl-es-branch-for-android/"/>
    <updated>2013-08-04T04:04:00+09:00</updated>
    <id>http://ktkr3d.github.io/blog/2013/08/04/compiling-irrlicht-ogl-es-branch-for-android</id>
    <content type="html"><![CDATA[<p><a href="http://ktkr3d.github.io/images/irrlicht_ogl-es_android.png"><img src="/images/irrlicht_ogl-es_android_tn.png"></a></p>

<ul>
<li>Compiling Irrlicht ogl-es branch for Android on Ubuntu GNOME 13.10 x86_64.</li>
<li>Native C/C++ Android Application (Native Activity).</li>
<li>Fullscreen (1080x1920)</li>
<li>Input Event Receiver</li>
<li>True Type Font (FreeType2)</li>
<li>OpenSL ES (Native Audio)</li>
</ul>


<!-- more -->


<h4>Environment</h4>

<ul>
<li>Android SDK: 22.0.5</li>
<li>Android NDK: r9</li>
<li>Android Device: Android 4.1.2 (API level 16)</li>
<li>Irrlicht 1.9 [r4528]</li>
</ul>


<h4>Download Irrlicht ogl-es branch</h4>

<p><code>http://sourceforge.net/p/irrlicht/code/</code></p>

<ol>
<li>Select <code>branches</code>, <code>ogl-es</code>, <code>Download Snapshot</code>.</li>
<li>Download.</li>
<li>Extract.</li>
</ol>


<h4>Compile Irrlicht Library</h4>

<p><code>bash
$ cd source/Irrlicht/Andorid
$ ndk-build -j4
</code></p>

<p>&ndash;> <code>lib/Android/libirrlicht.a</code></p>

<h4>Build example</h4>

<p><code>bash
$ cd examples/17.HelloWorld_Mobile
$ android update project --path . --target android-16
$ ndk-build -j4
$ ant debug
</code></p>

<p>&ndash;> <code>examples/17.HellowWorld_Mobile/HelloWorldMobile-debug.apk</code></p>

<h4>TrueType Font</h4>

<p><code>include/irrUString.h</code>, <code>jni/CGUITTFont.h</code>, <code>jni/CGUITTFont.cpp</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Irrlicht 1.8 trunk + XEffects]]></title>
    <link href="http://ktkr3d.github.io/blog/2012/06/30/irrlicht-1-8-trunk-xeffects/"/>
    <updated>2012-06-30T22:08:59+09:00</updated>
    <id>http://ktkr3d.github.io/blog/2012/06/30/irrlicht-1-8-trunk-xeffects</id>
    <content type="html"><![CDATA[<p><a href="/images/uploads/2012/06/irrlicht_1.8_xeffects.png"><img src="/images/uploads/2012/06/irrlicht_1.8_xeffects.png" alt="irrlicht 1.8 xeffects" /></a></p>

<p>Irrlicht 1.8 trunk でXEffects の影が有効にならなくなっていたので、XEffects のヘッダを修正してみた。Irrlicht 側のインタフェースが変わったのが原因かな。Irrlicht 1.8 ではXEffects を使っても画像が反転しないし、CGUITTFONT とも同時に使えるし、便利になったなぁ。環境はUbuntu 12.04 x86_64 + Irrlicht 1.8 trunk (SVN rev: 4170 ) + XEffects v1.3。</p>

<p>``` cpp EffectCB.h
virtual void OnSetConstants(irr::video::IMaterialRendererServices* services, irr::s32 userData)
{</p>

<pre><code>if(services-&gt;getVideoDriver()-&gt;getDriverType() == irr::video::EDT_OPENGL)
{
</code></pre>

<p>//      irr::f32 TexVar = 0;</p>

<pre><code>    irr::s32 TexVar = 0;
</code></pre>

<p>//      services->setPixelShaderConstant(&ldquo;ColorMapSampler&rdquo;, (irr::f32*)(&amp;TexVar), 1);</p>

<pre><code>    services-&gt;setPixelShaderConstant("ColorMapSampler", &amp;TexVar, 1);

    TexVar = 1;
</code></pre>

<p>//      services->setPixelShaderConstant(&ldquo;ScreenMapSampler&rdquo;, (irr::f32*)(&amp;TexVar), 1);</p>

<pre><code>    services-&gt;setPixelShaderConstant("ScreenMapSampler", &amp;TexVar, 1);

    TexVar = 2;
</code></pre>

<p>//      services->setPixelShaderConstant(&ldquo;DepthMapSampler&rdquo;, (irr::f32*)(&amp;TexVar), 1);</p>

<pre><code>    services-&gt;setPixelShaderConstant("DepthMapSampler", &amp;TexVar, 1);

    TexVar = 3;
</code></pre>

<p>//      services->setPixelShaderConstant(&ldquo;UserMapSampler&rdquo;, (irr::f32*)(&amp;TexVar), 1);</p>

<pre><code>    services-&gt;setPixelShaderConstant("UserMapSampler", &amp;TexVar, 1);
}
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android NDK + Android-x86 4.0.3]]></title>
    <link href="http://ktkr3d.github.io/blog/2012/06/17/android-ndk-android-x86-4-0-3/"/>
    <updated>2012-06-17T18:54:52+09:00</updated>
    <id>http://ktkr3d.github.io/blog/2012/06/17/android-ndk-android-x86-4-0-3</id>
    <content type="html"><![CDATA[<p><a href="/images/uploads/2012/06/android_ndk_android-x86.png"><img src="/images/uploads/2012/06/android_ndk_android-x86.png" alt="android ndk android-x86 irrlicht" /></a></p>

<p>Android 2.3 用のアプリをAndroid-x86 4.0.3 用にリビルドして、Inspiron duo 実機で動かしてみた。さすがにスマートフォンより動作が非常に軽快だけど、画面がiPod の広告みたいになってしまった。画像やフォントが表示されてないのは、なんでだろう。パスがずれているのかな。パスが違っていたらエラーになるはずなんだけど。ボタンイベントはタッチスクリーン上を指で押したら正しく動作した。</p>

<ol>
<li> Android 4.0.3 のターゲット情報は以下のとおり。ID は10。</li>
</ol>


<p>``` sh
$ android list target
id: 10 or &ldquo;android-15&rdquo;</p>

<pre><code> Name: Android 4.0.3
 Type: Platform
 API level: 15
 Revision: 3
 Skins: WXGA720, QVGA, WSVGA, WQVGA400, WQVGA432, HVGA, WVGA854, WXGA800, WVGA800 (default)
 ABIs : armeabi-v7a, x86
</code></pre>

<p>```</p>

<ol>
<li> Application.mk でx86 を指定</li>
</ol>


<p>``` text Application.mk</p>

<h1>APP_ABI := armeabi armeabi-v7a</h1>

<p>APP_ABI := armeabi-v7a x86
```</p>

<ol>
<li> プロジェクトをアップデート</li>
</ol>


<p><code>sh
$ android update project --path . --target 10
</code></p>

<ol>
<li> ビルド</li>
</ol>


<p><code>sh
$ ndk-build clean
$ ndk-build -j 4
$ ant clean
$ ant debug
</code></p>
]]></content>
  </entry>
  
</feed>
